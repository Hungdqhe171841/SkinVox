<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Google Analytics Script Loading</title>
</head>
<body>
    <h1>Google Analytics Script Loading Test</h1>
    <button onclick="testScriptLoading()">Test Script Loading</button>
    <button onclick="testGtagAvailability()">Test Gtag Availability</button>
    <button onclick="testDataLayer()">Test DataLayer</button>
    <button onclick="sendTestEvent()">Send Test Event</button>
    
    <div id="results"></div>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-C4NFL3C9TF"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-C4NFL3C9TF');
      
      console.log('🔍 Google Analytics script loaded');
      console.log('🔍 gtag function created:', typeof window.gtag);
      console.log('🔍 dataLayer created:', typeof window.dataLayer);
    </script>
    
    <script>
        function log(message) {
            console.log(message);
            document.getElementById('results').innerHTML += '<div>' + message + '</div>';
        }
        
        function testScriptLoading() {
            log('🧪 Testing Script Loading...');
            
            // Check if script tag exists
            const script = document.querySelector('script[src*="googletagmanager.com/gtag/js"]');
            if (script) {
                log('✅ Google Analytics script tag found');
                log('📊 Script src: ' + script.src);
            } else {
                log('❌ Google Analytics script tag not found');
            }
            
            // Check if gtag function exists
            if (typeof window.gtag === 'function') {
                log('✅ gtag function is available');
            } else {
                log('❌ gtag function is not available');
                log('🔍 window.gtag type: ' + typeof window.gtag);
            }
            
            // Check if dataLayer exists
            if (typeof window.dataLayer === 'object' && Array.isArray(window.dataLayer)) {
                log('✅ dataLayer is available');
                log('📊 dataLayer length: ' + window.dataLayer.length);
            } else {
                log('❌ dataLayer is not available');
                log('🔍 window.dataLayer type: ' + typeof window.dataLayer);
            }
        }
        
        function testGtagAvailability() {
            log('🧪 Testing Gtag Availability...');
            
            if (typeof window.gtag === 'function') {
                log('✅ gtag function is available');
                
                // Test gtag call
                try {
                    window.gtag('event', 'test_availability', {
                        event_category: 'Test',
                        event_label: 'Availability Test',
                        value: 1
                    });
                    log('✅ gtag event sent successfully');
                } catch (error) {
                    log('❌ Error sending gtag event: ' + error.message);
                }
            } else {
                log('❌ gtag function is not available');
            }
        }
        
        function testDataLayer() {
            log('🧪 Testing DataLayer...');
            
            if (typeof window.dataLayer === 'object' && Array.isArray(window.dataLayer)) {
                log('✅ dataLayer is available');
                log('📊 dataLayer length: ' + window.dataLayer.length);
                log('📊 dataLayer contents: ' + JSON.stringify(window.dataLayer, null, 2));
            } else {
                log('❌ dataLayer is not available');
            }
        }
        
        function sendTestEvent() {
            log('🧪 Sending Test Event...');
            
            if (typeof window.gtag === 'function') {
                window.gtag('event', 'manual_test', {
                    event_category: 'Test',
                    event_label: 'Manual Test Event',
                    value: 1
                });
                log('✅ Test event sent');
            } else {
                log('❌ Cannot send test event - gtag not available');
            }
        }
        
        // Auto-test on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('🔍 Auto-testing after page load...');
                testScriptLoading();
                testGtagAvailability();
                testDataLayer();
            }, 2000);
        });
    </script>
</body>
</html>
